
\tikzstyle{Absch} = [rectangle, draw, 
    text centered]
\tikzstyle{keinBeweis} = [rectangle, fill=gray!25, 
    text centered]    

\tikzstyle{BewTeil} = []


\tikzstyle{Box} = [rectangle, draw, text centered, rounded corners]
\tikzstyle{Alg} = [rectangle, draw, fill=gray!50, text centered]
\tikzstyle{Text} = [text centered]
\tikzstyle{Image} = []

\tikzstyle{arrow} = [draw, -latex']
\tikzstyle{line} = [draw]


\begin{tikzpicture}[node distance = 5em, auto]

% EINGABE:
\node [Box, text width=20em] (input) {\textbf{Input:} \\ CLR-Instanz $((\ClientSet\cup\FacilitySet,E),c,\phi,d,u)$};
\node [below of=input] (under-input) {};
\node [Image, above of=input, node distance=6em] (input-img) {\includegraphics[width=8em]{bilder/instance.pdf}};

% ULF-Instanz:
\node [Box, left of=under-input, text width=14em, node distance=8em] (ULF) 
	{\textbf{ULF-Instanz:} \\ $((\ClientSet\cup\FacilitySet,E),\tilde{c},\phi,d)$ \\
	wobei $\tilde{c}:E \to \IR_{\geq 0}: e \mapsto \frac{2}{u}c(e)$};
\node [Text, left of=ULF, text width=12em, node distance=15em] (ULF-lower-bound) {$\leadsto$ Untere Schranke: $\OPT(\CLR) \geq \OPT(\ULF)$};
\node [Alg, below of=ULF, text width=14em] (ULF-solving) {löse approximativ (mit Greedy)};
\node [Image, left of=ULF-solving, node distance=15em] (ULF-img) {\includegraphics[width=5em]{bilder/ULF.pdf}};

% MST-Instanz:
\node [Box, right of=under-input, text width=14em, node distance=8em] (MST)
	{\textbf{MST-Instanz:} \\ $((\ClientSet\cup\FacilitySet\cup\{r\},E^\prime),c^\prime)$ \\
	$E^\prime := E \cup \{\{r,f\}\mid f\in\FacilitySet\}$ \\
	$c^\prime(f,v) := c(f,v) + \frac{1}{2}\phi(f),$ \\
	$c^\prime(r,f) := 0, c^\prime(v,w):=c(c,w)$};
\node [Text, right of=MST, text width=12em, node distance=15em] (MST-lower-bound) {$\leadsto$ Untere Schranke: $\OPT(\CLR) \geq \OPT(\MST)$};
\node [Alg, below of=MST, text width=14em] (MST-solving) {löse exakt (mit ???)};
\node [Image, right of=MST-solving, node distance=15em] (MST-img) {\includegraphics[width=5em]{bilder/MST.pdf}};

% MERGE-Phase:
\node [Text, below of=under-input, node distance=8em] (merge) {\textbf{Merge-Phase:}};

\node [Alg, below of=merge, node distance=1.5em, text width=30em] (m-facilities) {
		\begin{minipage}{30em}\begin{algorithmic}
		\State Eröffne in $\ULF$ oder $\MST$ verwendete Fabriken
		\end{algorithmic}\end{minipage}
	};
\node [Text, left of=m-facilities, node distance=25em, text width=15em] () 
	{beschränkt durch die entsprechenden Eröffnungskosten in $\ULF$ und $\MST$};

% Große Kunden
\node [Alg, below of=m-facilities, node distance=4em] (m-big-clients) {
		\begin{minipage}{30em}\begin{algorithmic}
		\For{Kunden $v$ mit $d(v)\geq u$}
			\State Verbinde $v$ durch $\frac{d(v)}{u}$ Touren mit nächster offener Fabrik
		\EndFor
		\end{algorithmic}\end{minipage}
	};
\node [Image, right of=m-big-clients, node distance=25em] () {
	\includegraphics[width=5em]{bilder/largeDemand1.pdf}
	\includegraphics[width=5em]{bilder/largeDemand2.pdf}
};
\node [Text, left of=m-big-clients, node distance=25em, text width=15em] () 
	{beschränkt durch $2\times$ den entsprechenden Verbindungskosten in $\ULF$};

% Kleine Kunden
\node [Alg, below of=m-big-clients, node distance=4em] (m-small-clients) {
		\begin{minipage}{30em}\begin{algorithmic}\algtext*{EndFor}
		\For{Durch $\MST$ eröffnete Fabrik $f$ tue}
		\State Definitionen...
		\EndFor
		\end{algorithmic}\end{minipage}
	};

% Relieve-Schritte
\node [Alg, below of=m-small-clients, node distance=5em] (m-relieve) {
		\begin{minipage}{30em}\begin{algorithmic}\algtext*{For}\algtext*{EndFor}
			\For
			\While{$D_f > 0$}
			\State Finde $v \in S_f$ mit $D_v > u$ und f.a. Kinder $w$ von $v$: $D_w \leq u$
			\State Zerlege $S_v$ in Teilbäume ...
			\EndWhile
			\EndFor
			\end{algorithmic}\end{minipage}
	};
\node [Image, right of=m-relieve, node distance=25em] () {
		\includegraphics[width=5em]{bilder/relieveTour1.pdf}
		\includegraphics[width=5em]{bilder/relieveTour2.pdf}
		\includegraphics[width=5em]{bilder/relieveTour3.pdf}
	};
\node [Text, left of=m-relieve, node distance=25em, text width=15em] () 
	{Jede Tour ist beschränkt durch $2\times$ die Kantenkosten im $\MST$ und $2\times$ den Verbindungskosten aller Knoten der Tour in $\ULF$};

% Rest
\node [Alg, below of=m-relieve, node distance=5em] (m-remaining) {
		\begin{minipage}{30em}\begin{algorithmic}\algtext*{For}
		\For
		\State Mache Rest
		\EndFor
		\end{algorithmic}\end{minipage}
	};
\node [Image, right of=m-remaining, node distance=25em] () {
	\includegraphics[width=5em]{bilder/remainingTour1.pdf}
	\includegraphics[width=5em]{bilder/remainingTour2.pdf}
};
\node [Text, left of=m-remaining, node distance=25em, text width=15em] () 
	{beschränkt durch $2\times$ den Verbindungskosten in $\MST$};


% AUSGABE:
\node [Box, below of=m-remaining, node distance=3em] (output) {\textbf{Output}};
\node [Image, below of=output] (outpu-img) {\includegraphics[width=8em]{bilder/output.pdf}};


% PATHS:

\path [arrow] (input.south) -- (ULF.north);    
\path [arrow] (input.south) -- (MST.north); 

\path [arrow] (ULF) -- (ULF-solving.north);
\path [arrow] (MST) -- (MST-solving.north);
\path [arrow] (ULF-solving.south) -- (merge.north);
\path [arrow] (MST-solving.south) -- (merge.north);

\path [line] (m-facilities) -- (m-big-clients);
\path [line] (m-big-clients) -- (m-small-clients);
\path [line] (m-small-clients) -- (m-relieve);
\path [line] (m-relieve) -- (m-remaining);

\path [arrow] (m-remaining.south) -- (output.north);

\end{tikzpicture}
